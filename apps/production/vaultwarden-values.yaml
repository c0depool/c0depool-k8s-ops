apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: vaultwarden
  namespace: vaultwarden
spec:
  chart:
    spec:
      version: ">=1.0.0"
  values:
    image:
      repository: vaultwarden/server
      pullPolicy: IfNotPresent
      tag: 1.27.0
    service:
      main:
        ports:
          http:
            port: 80
          websocket:
            enabled: false
            port: 3012    
    persistence:
      config:
        enabled: true
        storageClass: longhorn             
  valuesFrom:
    - kind: Secret
      name: vaultwarden-secrets
      valuesKey: vaultwarden-secrets.yaml
      optional: true